## 代码整洁之道

### 第三章

第三章讲的是函数，说了这么一句话："Function should do one thing. They should do it well. They should do it only. "（函数只应该做一件事情，把一件事情做好，而且只由它来做这一件事情），听起来很简单的一句话但是要践行这条原则却并不容易，所以我们的代码中才会有很多的坏味道（请参考《重构：改善既有代码的设计》一书的第三章）。事实上，上升一个层次，我们在设计类的时候也应该如此，这是面向对象设计原则中说的单一职责原则（SRP），当我们的代码中出现了冗长的方法或者巨大的类的时候，我们就应该依据职责来对其进行拆分，这样程序的结构才会趋于合理，最终达到"高内聚"的目标。当然，这一章里面还提到很多理念，包括：Command Query Separation（一个方法要么执行某种命令，要么返回查询数据）、DRY（不要重复自己）、Prefer Exceptions to Returning Error Codes（异常优于返回错误码）等。

### 第四章

第四章讲的是注释，有一句话我很喜欢，说的是："Comments Do Not Make Up for Bad Code."（注释不是对劣质代码的补救）。事实上好的代码即便没有注释也拥有良好的可读性，但恰当的注释会让代码变得更可读、可维护性更高。

### 第五章

第五章讲的是代码风格。现代IDE（集成开发环境）几乎都有代码格式化代码的功能，你只需要设置好你使用的代码风格就可以了，其实不只是IDE，很多高级的文本编辑工具也能够按照指定的风格格式化你的代码。用什么样的代码风格不是关键，关键是整个项目组的成员应当使用相同的代码风格，让多个人编写的代码看起来像一个人书写的。我个在代码中使用的括号风格是1TBS（One True Bracing Style，也叫做K&R风格，这种风格是Kernighan和Ritchie两位老师在"The C Programming Language"一书中使用的代码风格），当然Allman风格（FreeBSD系统的作者之一使用的代码风格）也是很好的选择。

### 第六章

第六章讨论的是对象和数据结构，读完之后的感觉是虽然我们天天都嚷着吼着要面向对象编程，但是很多时候我们都使用了类的退化结构，包括我们开发时经常使用的失血模型和贫血模型（事务脚本模式）都和面向对象的设计理念相违背。我得承认在读这一章的时候我可能没有抓住作者的观点。

### 第七章

第七章对错误处理（异常）的讲解非常精彩的，整洁的代码中对错误的处理应当是被分离的关注点（不要跟正常的业务逻辑混杂在一起），而面向对象中的异常机制就是一种在不打乱原有业务逻辑的前提下处理掉程序在运行时发生的不正常状况的手段。这章有两个观点我特别欣赏，一是"Use Unchecked Exceptions"（非受检异常允许你在适当的地方处理异常，而适当的地方就是异常影响代码执行逻辑的地方，不管做哪种类型的应用，都应该尽可能向用户隐藏异常的发生，除非发生了不可挽救的状况，这才是符合最小惊讶原则的设计）；二是"Don’t Return Null"（如果一个方法在出状况的时候返回null，那么调用者都要通过频繁的检查返回值来判定是否出错，一旦忘了这件事情就有可能出错，既然null是一种异常状况，那么用抛出异常的方式来代替返回null明显是更好的做法）。

### 第八章

第八章的内容对实际开发有重要的指导意义，因为我们的项目中不可避免的要使用第三方工具，因此我们需要将这些东西整洁的纳入到我们的系统中，这时就需要考虑系统边界的问题。有的时候我们会千辛万苦的发现系统中的一些bug是来源于第三方工具的，当然我们基本上没有时间去重头学习和研究第三方工具或者自己写代码来实现第三方工具的功能，但是我们至少应该先对第三方工具进行测试。我在以前的项目中，即使用Apache提供的那些著名的第三方工具，我的做法也是先写测试代码对这些工具的可用性和有效性进行证实，当然有的时候可能是过于谨慎了，但这种习惯和做法本身是很好的。在这种场景下，适配器模式是非常好的设计，它不仅能将不兼容的接口改写成兼容的接口，还能够对通过对第三方工具重新封装来避免边界的变化对系统的影响。

实践：接入第三方登录、支付、分享等功能，使用装饰器模式；并且对边界进行测试，比如支付的最小金额、订单超时时间

### 第九章

第九章的内容是单元测试。Bob大叔是TDD（测试驱动开发）的倡导者，这一章讲的是如何编写整洁的测试，Bob大叔的答案是FIRST规则（Fast、Independent、Repeatable、Self-Validating、Timely）。

### 第十章

第十章介绍类的设计，最重要的还是SRP（单一职责原则）。

### 第十一章

第十一章是关于系统设计的内容，开篇引用了微软首席技术官Ray Ozzie的一句话："Complexity kills. It sucks the life out of developers, it makes products difficult to plan, build and test."（复杂要人命，它消磨开发者的生命，让产品难于规划、构建和测试）。这章对于希望了解面向切面编程的开发者是极好的，包括了对依赖注入、代理模式以及AOP的探讨。

### 第十二章

第十二章探讨了系统的迭代式演进。

### 第十三章

第十三章对并发编程的讨论非常经常，很多开发者都畏惧并发编程，也有的开发者迷信多线程可以解决所有的并发问题，如果你是这两类人之一，本章会教给你真正的并发编程。这一章的内容我重新整理了一篇文章，已经发布在CSDN的博客上，名为[《关于Java并发编程的总结和思考》](http://blog.csdn.net/jackfrued/article/details/44499227)。

### 第十四章

第十四章是一个精彩的案例用来讲解对代码的持续改进，你可以自己好好阅读一次。第十五章到第十七章说的都是重构，相当精彩。如果你还没有来得及读《重构：改善既有代码的设计》一书，你可以先读读这几张中探讨的代码的坏味道及其改进方案。